import{z as $e,d as je,r as i,A as qe,I as De,B as Fe,e as u,F as Ie,c as b,o as r,G as H,f as t,H as W,l as a,i as n,m as Re,J as U,K as S,j as w,n as f,t as F,h as p,L as X,k as I,C as Le}from"./index-CqeaECIw.js";import{l as Y,g as Z,d as Te,u as ee,a as Be}from"./NursingPlan-C9W9rrCY.js";import{g as ze}from"./NursingProject-i0CsEZsI.js";const He={class:"app-container"},Ee={class:"info family"},Me={class:"tableHead"},Ae={key:0},Ke={class:"tableBody"},Oe={class:"column"},Qe={class:"column"},Ge={class:"column"},Je={class:"column"},We={key:0,class:"column"},Xe={key:0,class:"dialog-footer"},Ye=$e({name:"Plan"}),al=Object.assign(Ye,{setup(Ze){const{proxy:_}=je(),{nursing_plan_status:E}=_.useDict("nursing_plan_status"),R=i([]),v=i([{projectId:"",executeTime:"",executeCycle:"",executeFrequency:""}]),x=i(!0),le=i(!0),L=i([]),te=i(!0),ae=i(!0),$=i(0),j=i(""),V=i(!1),T=i([]),c=i(!1),s=i({status:"1",sortNo:1}),oe=qe({queryParams:{pageNum:1,pageSize:10,planName:null,status:null},rules:{planName:[{required:!0,message:"护理计划名称为空，请输入护理计划名称",trigger:"blur"}],status:[{required:!0,message:"状态为空，请选择状态",trigger:"change"}],sortNo:[{required:!0,message:"排序为空，请选择排序",trigger:"change"}]}}),{queryParams:m,rules:ne}=De(oe),se=i([{label:"天",value:"0"},{label:"周",value:"1"},{label:"月",value:"2"}]);function M(){x.value=!0,Y(m.value).then(o=>{R.value=o.rows,$.value=o.total,x.value=!1})}Fe(()=>{ue()});const ue=()=>{ze().then(o=>{T.value=o.data,console.log(T.value)})},de=()=>{const o={projectId:"",executeTime:"",executeCycle:"",executeFrequency:""};v.value.push(o)},re=(o,e)=>{v.value.length!==1&&v.value.splice(e,1)};function N(){x.value=!0,Y(m.value).then(o=>{R.value=o.rows,$.value=o.total,x.value=!1})}function q(){V.value=!1,c.value=!1,B()}function B(){s.value={planName:null,status:"1",sortNo:1},v.value=[{projectId:"",executeTime:"",executeCycle:"",executeFrequency:"1"}],console.log(v.value),_.resetForm("planRef")}function z(){m.value.pageNum=1,N()}function ie(){_.resetForm("queryRef"),z()}function ce(o){L.value=o.map(e=>e.id),te.value=o.length!=1,ae.value=!o.length}function me(){B(),V.value=!0,j.value="添加护理计划"}function pe(o){B();const e=o.id||L.value;Z(e).then(g=>{s.value=g.data,s.value.status=String(s.value.status),v.value=s.value.projectPlans,V.value=!0,j.value="修改护理计划"})}const _e=o=>{Z(o).then(e=>{s.value=e.data,s.value.status=String(s.value.status),v.value=s.value.projectPlans,V.value=!0,j.value="修改护理计划"})};function ve(){if(fe(v.value)){_.$modal.msgError("请勿选择重复的护理项目");return}s.value.projectPlans=v.value,console.log(s.value),_.$refs.planRef.validate(o=>{o&&(s.value.id!=null?ee(s.value).then(e=>{_.$modal.msgSuccess("修改成功"),q(),N()}):Be(s.value).then(e=>{_.$modal.msgSuccess("新增成功"),q(),N()}))})}function fe(o){if(!Array.isArray(o)||o.length===0)return!1;const e=new Set;for(const g of o)g.projectId!==void 0&&e.add(g.projectId);return e.size!==o.length}const ge=async o=>{try{const e=o.status,g=e===0?"启用":"禁用",y=`是否确认${g}护理项目的数据项？`;if(await _.$modal.confirm(y)){const h={id:o.id,status:e===0?1:0};ee(h).then(D=>{_.$modal.msgSuccess(`${g}成功`),N()})}}catch{console.error("操作失败，请重试或联系管理员")}};function be(o){const e=o.id||L.value;_.$modal.confirm("是否确认删除这条护理计划？").then(function(){return Te(e)}).then(()=>{N(),_.$modal.msgSuccess("删除成功")}).catch(()=>{})}const A=()=>{const o=s.value.sortNo;o<=1&&(s.value.sortNo=1),o>99999999&&(s.value.sortNo=99999999)},ye=o=>{c.value=!0,V.value=!0,_e(o.id)};return M(),(o,e)=>{const g=u("el-input"),y=u("el-form-item"),h=u("el-option"),D=u("el-select"),k=u("el-button"),K=u("el-form"),O=u("el-col"),Q=u("el-row"),P=u("el-table-column"),ke=u("el-tag"),Ve=u("el-table"),Ce=u("pagination"),we=u("el-radio"),xe=u("el-radio-group"),G=u("el-input-number"),Ne=u("el-time-picker"),he=u("Minus"),J=u("el-icon"),Pe=u("Plus"),Ue=u("el-dialog"),Se=Ie("loading");return r(),b("div",He,[H(t(K,{model:a(m),ref:"queryRef",inline:!0,"label-width":"68px"},{default:n(()=>[t(y,{label:"名称",prop:"planName"},{default:n(()=>[t(g,{modelValue:a(m).planName,"onUpdate:modelValue":e[0]||(e[0]=l=>a(m).planName=l),placeholder:"请输入名称",clearable:"",onKeyup:Re(z,["enter"])},null,8,["modelValue"])]),_:1}),t(y,{label:"状态",prop:"status"},{default:n(()=>[t(D,{modelValue:a(m).status,"onUpdate:modelValue":e[1]||(e[1]=l=>a(m).status=l),placeholder:"请选择状态",style:{width:"200px"},clearable:""},{default:n(()=>[(r(!0),b(U,null,S(a(E),l=>(r(),w(h,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:n(()=>[t(k,{type:"primary",icon:"Search",onClick:z},{default:n(()=>e[10]||(e[10]=[f("搜索")])),_:1,__:[10]}),t(k,{icon:"Refresh",onClick:ie},{default:n(()=>e[11]||(e[11]=[f("重置")])),_:1,__:[11]})]),_:1})]),_:1},8,["model"]),[[W,a(le)]]),t(Q,{gutter:10,class:"mb8"},{default:n(()=>[t(O,{span:1.5},{default:n(()=>[t(k,{type:"primary",plain:"",icon:"Plus",onClick:me},{default:n(()=>e[12]||(e[12]=[f("新增")])),_:1,__:[12]})]),_:1})]),_:1}),H((r(),w(Ve,{data:a(R),onSelectionChange:ce},{default:n(()=>[t(P,{label:"序号",type:"index",width:"50"}),t(P,{label:"名称",align:"center",prop:"planName"}),t(P,{label:"状态",align:"center",prop:"status"},{default:n(l=>[t(ke,{type:l.row.status===1?"success":"danger"},{default:n(()=>[f(F(l.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(P,{label:"创建时间",align:"center",prop:"createTime",width:"180"},{default:n(l=>[p("span",null,F(o.parseTime(l.row.createTime,"{y}-{m}-{d} {h}:{i}:{s}")),1)]),_:1}),t(P,{label:"操作",align:"center",fixed:"right",width:"280","class-name":"small-padding fixed-width"},{default:n(l=>[t(k,{link:"",type:"primary",icon:"Edit",class:X(l.row.count?"disabled":""),onClick:C=>pe(l.row)},{default:n(()=>e[13]||(e[13]=[f("修改")])),_:2,__:[13]},1032,["class","onClick"]),t(k,{link:"",type:"primary",icon:"Delete",class:X(l.row.count?"disabled":""),onClick:C=>be(l.row)},{default:n(()=>e[14]||(e[14]=[f("删除")])),_:2,__:[14]},1032,["class","onClick"]),t(k,{link:"",type:"primary",icon:"Delete",onClick:C=>ye(l.row)},{default:n(()=>e[15]||(e[15]=[f("查看")])),_:2,__:[15]},1032,["onClick"]),t(k,{link:"",type:"primary",icon:l.row.status==0?"Unlock":"lock",onClick:C=>ge(l.row)},{default:n(()=>[f(F(l.row.status==1?"禁用":"启用"),1)]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[Se,a(x)]]),H(t(Ce,{total:a($),page:a(m).pageNum,"onUpdate:page":e[2]||(e[2]=l=>a(m).pageNum=l),limit:a(m).pageSize,"onUpdate:limit":e[3]||(e[3]=l=>a(m).pageSize=l),onPagination:M},null,8,["total","page","limit"]),[[W,a($)>0]]),t(Ue,{title:a(j),modelValue:a(V),"onUpdate:modelValue":e[8]||(e[8]=l=>Le(V)?V.value=l:null),width:"1050px",onClose:e[9]||(e[9]=l=>q())},{default:n(()=>[t(K,{ref:"planRef",model:a(s),rules:a(ne),"label-width":"120px"},{default:n(()=>[t(Q,{gutter:"10"},{default:n(()=>[t(O,{span:24,class:"elcolFlex"},{default:n(()=>[t(y,{label:"护理计划名称：",prop:"planName"},{default:n(()=>[t(g,{modelValue:a(s).planName,"onUpdate:modelValue":e[4]||(e[4]=l=>a(s).planName=l),disabled:a(c)},null,8,["modelValue","disabled"])]),_:1}),t(y,{label:"状态：",prop:"status"},{default:n(()=>[t(xe,{modelValue:a(s).status,"onUpdate:modelValue":e[5]||(e[5]=l=>a(s).status=l),disabled:a(c)},{default:n(()=>[(r(!0),b(U,null,S(a(E),l=>(r(),w(we,{value:l.value,label:l.value,key:l.value},{default:n(()=>[f(F(l.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(y,{label:"排序：",prop:"sortNo"},{default:n(()=>[t(G,{disabled:a(c),modelValue:a(s).sortNo,"onUpdate:modelValue":e[6]||(e[6]=l=>a(s).sortNo=l),min:0,"large-number":"",max:999999,"decimal-places":0,onBlur:A,onChange:A},null,8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),t(y,{label:"护理项目："},{default:n(()=>[p("div",Ee,[p("div",Me,[e[16]||(e[16]=p("div",null,"护理项目名称",-1)),e[17]||(e[17]=p("div",null,"期望服务时间",-1)),e[18]||(e[18]=p("div",null,"执行周期",-1)),e[19]||(e[19]=p("div",null,"执行频次(次)",-1)),a(c)?I("",!0):(r(),b("div",Ae,"操作"))]),p("div",Ke,[(r(!0),b(U,null,S(a(v),(l,C)=>(r(),b("div",{class:"tableColumn",key:C},[p("div",Oe,[t(D,{disabled:a(c),modelValue:l.projectId,"onUpdate:modelValue":d=>l.projectId=d,placeholder:"请选择"},{default:n(()=>[(r(!0),b(U,null,S(a(T),d=>(r(),w(h,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),p("div",Qe,[t(Ne,{modelValue:l.executeTime,"onUpdate:modelValue":d=>l.executeTime=d,format:"HH:mm:ss","value-format":"HH:mm:ss",style:{width:"100%"},placeholder:"请选择时间选择",disabled:a(c),clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),p("div",Ge,[t(D,{modelValue:l.executeCycle,"onUpdate:modelValue":d=>l.executeCycle=d,placeholder:"请选择",disabled:a(c)},{default:n(()=>[(r(!0),b(U,null,S(a(se),d=>(r(),w(h,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),p("div",Je,[t(G,{modelValue:l.executeFrequency,"onUpdate:modelValue":d=>l.executeFrequency=d,controls:!1,max:7,min:1,disabled:a(c)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),a(c)?I("",!0):(r(),b("div",We,[a(v).length>1?(r(),w(J,{key:0,onClick:d=>re(l,C),class:"delect"},{default:n(()=>[t(he)]),_:2},1032,["onClick"])):I("",!0),t(J,{onClick:de,class:"add"},{default:n(()=>[t(Pe)]),_:1})]))]))),128))])])]),_:1})]),_:1},8,["model","rules"]),a(c)?I("",!0):(r(),b("div",Xe,[t(k,{type:"primary",onClick:ve},{default:n(()=>e[20]||(e[20]=[f("确定")])),_:1,__:[20]}),t(k,{onClick:e[7]||(e[7]=l=>q())},{default:n(()=>e[21]||(e[21]=[f("取消")])),_:1,__:[21]})]))]),_:1},8,["title","modelValue"])])}}});export{al as default};
